# Paimon DEX - 全栈架构升级任务摘要

> **生成时间**: 2025-11-14
> **项目周期**: 24 周（6 个月）
> **总任务数**: 66 个原子级任务
> **预计工作量**: 120 工作日

---

## 📊 项目概览

### 技术栈

- **前端**: Next.js 14 + Reown AppKit + Material-UI v5
- **后端**: Node.js + NestJS + Prisma ORM
- **数据库**: PostgreSQL (Supabase) + Redis (Upstash)
- **区块链**: BSC + wagmi v2 + viem
- **第三方服务**: Blockpass KYC + WalletConnect

### 核心目标

1. ✅ **降低用户门槛**: 社交登录（Email/Google/X）使转化率提升 3-4 倍
2. ✅ **合规化优势**: KYC 集成解锁机构投资者
3. ✅ **增长黑客**: 任务系统激活用户 + 社交裂变
4. ✅ **架构升级**: 建立后端基础设施，支撑未来 6-12 个月发展
5. ✅ **数据优势**: 链上数据索引 + 历史数据存储，性能提升 10-100 倍

---

## 🎯 三个阶段详解

### Phase 1: 后端 MVP + 钱包迁移（Week 1-8）🔴 P0

**目标**: 建立完整的后端基础设施 + 钱包社交登录 + 用户中心重构

**任务数**: 35 个
**预计耗时**: 52.5 工作日（约 10.5 周）

#### Stage 1.1: 后端基础架构（Task 1-7）

| Task | 标题 | 复杂度 | 预计天数 |
|------|------|--------|----------|
| 1 | 初始化 NestJS 后端项目 | 2 | 0.5 |
| 2 | 集成 Prisma ORM + PostgreSQL | 3 | 1 |
| 3 | 集成 Redis（Upstash） | 2 | 0.5 |
| 4 | 设计并创建数据库 Schema | 4 | 1.5 |
| 5 | 创建通用模块（Logger, Config, Exception Filter） | 3 | 1 |
| 6 | 配置 API 文档（Swagger） | 2 | 0.5 |
| 7 | 部署后端到 Railway/Render | 3 | 1 |

**小计**: 5.5 天

#### Stage 1.2: 用户系统（Task 8-11）

| Task | 标题 | 复杂度 | 预计天数 |
|------|------|--------|----------|
| 8 | 实现 JWT 认证模块 | 4 | 1.5 |
| 9 | 实现钱包签名登录 | 5 | 2 |
| 10 | 实现社交登录（Reown OAuth） | 6 | 2.5 |
| 11 | 创建用户管理 API | 3 | 1 |

**小计**: 7 天

#### Stage 1.3: 钱包迁移（Task 12-16）

| Task | 标题 | 复杂度 | 预计天数 |
|------|------|--------|----------|
| 12 | 移除 RainbowKit 依赖 | 2 | 0.5 |
| 13 | 安装和配置 Reown AppKit | 4 | 1.5 |
| 14 | 突出显示 Binance Wallet | 2 | 0.5 |
| 15 | 集成社交登录 UI | 5 | 2 |
| 16 | 测试钱包迁移完整性 | 3 | 1 |

**小计**: 5.5 天

#### Stage 1.4: KYC 模块（Task 17-21）

| Task | 标题 | 复杂度 | 预计天数 |
|------|------|--------|----------|
| 17 | 集成 Blockpass SDK（前端） | 4 | 1.5 |
| 18 | 实现 KYC Webhook 接收（后端） | 5 | 2 |
| 19 | 实现 KYC 状态查询 API | 3 | 1 |
| 20 | 实现 KYC Tier 系统 | 4 | 1.5 |
| 21 | 创建 KYC 用户界面 | 3 | 1 |

**小计**: 7 天

#### Stage 1.5: 任务中心 MVP（Task 22-26）

| Task | 标题 | 复杂度 | 预计天数 |
|------|------|--------|----------|
| 22 | 设计任务系统数据模型 | 4 | 1.5 |
| 23 | 实现链上任务验证引擎 | 7 | 3 |
| 24 | 实现任务进度跟踪 API | 4 | 1.5 |
| 25 | 实现任务奖励发放 | 6 | 2.5 |
| 26 | 创建任务中心 UI | 4 | 1.5 |

**小计**: 10 天

#### Stage 1.6: 用户中心重构（Task 27-31）

| Task | 标题 | 复杂度 | 预计天数 |
|------|------|--------|----------|
| 27 | 创建用户中心路由和布局 | 3 | 1 |
| 28 | 迁移 Portfolio Hub 到用户中心 Tab 1-3 | 4 | 1.5 |
| 29 | 添加 KYC Tab（Tab 4） | 2 | 0.5 |
| 30 | 添加任务中心 Tab（Tab 5） | 2 | 0.5 |
| 31 | 重构导航栏钱包按钮 | 3 | 1 |

**小计**: 4.5 天

#### Stage 1.7: 推荐系统（Task 32-35）

| Task | 标题 | 复杂度 | 预计天数 |
|------|------|--------|----------|
| 32 | 实现推荐码生成逻辑 | 3 | 1 |
| 33 | 实现推荐关系记录 | 4 | 1.5 |
| 34 | 实现推荐统计 API | 3 | 1 |
| 35 | 创建推荐中心 UI（用户中心 Tab 6） | 3 | 1 |

**小计**: 4.5 天

**Phase 1 总计**: 52.5 工作日

---

### Phase 2: 数据层优化（Week 9-16）🟠 P1

**目标**: 链上数据索引 + 历史数据存储 + 实时通知

**任务数**: 19 个
**预计耗时**: 38 工作日（约 7.6 周）

#### Stage 2.1: 链上数据索引器（Task 36-41）

| Task | 标题 | 复杂度 | 预计天数 |
|------|------|--------|----------|
| 36 | 设计索引器架构 | 5 | 2 |
| 37 | 实现 LP 仓位索引 | 6 | 2.5 |
| 38 | 实现 Vault 仓位索引 | 7 | 3 |
| 39 | 实现 veNFT 仓位索引 | 6 | 2.5 |
| 40 | 实现定时扫描机制 | 5 | 2 |
| 41 | 创建加速版 Portfolio API | 4 | 1.5 |

**小计**: 13.5 天

#### Stage 2.2: 历史数据存储（Task 42-46）

| Task | 标题 | 复杂度 | 预计天数 |
|------|------|--------|----------|
| 42 | 创建时序数据表（TimescaleDB） | 5 | 2 |
| 43 | 实现历史 APR 记录 | 4 | 1.5 |
| 44 | 实现历史收益记录 | 5 | 2 |
| 45 | 创建历史数据查询 API | 4 | 1.5 |
| 46 | 前端集成历史数据图表 | 3 | 1 |

**小计**: 8 天

#### Stage 2.3: 实时通知（Task 47-50）

| Task | 标题 | 复杂度 | 预计天数 |
|------|------|--------|----------|
| 47 | 集成 Socket.IO（后端） | 5 | 2 |
| 48 | 实现任务完成通知 | 3 | 1 |
| 49 | 实现清算预警通知 | 5 | 2 |
| 50 | 前端集成 Socket.IO 客户端 | 4 | 1.5 |

**小计**: 6.5 天

#### Stage 2.4: 优化与测试（Task 51-54）

| Task | 标题 | 复杂度 | 预计天数 |
|------|------|--------|----------|
| 51 | 数据库索引优化 | 4 | 1.5 |
| 52 | Redis 缓存策略优化 | 5 | 2 |
| 53 | 性能压力测试 | 5 | 2 |
| 54 | 端到端测试（E2E） | 6 | 2.5 |

**小计**: 8 天

**Phase 2 总计**: 38 工作日

---

### Phase 3: 智能化升级（Week 17-24）🟡 P2

**目标**: 用户积分系统 + 数据分析 + 智能推荐

**任务数**: 12 个
**预计耗时**: 26.4 工作日（约 5.3 周）

#### Stage 3.1: 用户积分系统（Task 55-58）

| Task | 标题 | 复杂度 | 预计天数 |
|------|------|--------|----------|
| 55 | 设计积分系统规则 | 4 | 1.5 |
| 56 | 实现积分获取逻辑 | 5 | 2 |
| 57 | 实现积分排行榜 | 4 | 1.5 |
| 58 | 实现积分兑换功能 | 5 | 2 |

**小计**: 7 天

#### Stage 3.2: 数据分析（Task 59-60）

| Task | 标题 | 复杂度 | 预计天数 |
|------|------|--------|----------|
| 59 | 实现用户画像分析 | 6 | 2.5 |
| 60 | 创建管理员数据分析看板 | 5 | 2 |

**小计**: 4.5 天

#### Stage 3.3: 智能推荐（Task 61-63）

| Task | 标题 | 复杂度 | 预计天数 |
|------|------|--------|----------|
| 61 | 实现交易对推荐算法 | 7 | 3 |
| 62 | 实现策略推荐 | 6 | 2.5 |
| 63 | 前端集成推荐功能 | 3 | 1 |

**小计**: 6.5 天

#### Stage 3.4: 高级功能（Task 64-66）

| Task | 标题 | 复杂度 | 预计天数 |
|------|------|--------|----------|
| 64 | 多链支持规划 | 6 | 2.5 |
| 65 | 完善 API 文档 | 3 | 1 |
| 66 | 创建用户指南文档 | 4 | 1.5 |

**小计**: 5 天

**Phase 3 总计**: 26.4 工作日

---

## 📈 任务统计

### 按优先级分布

| 优先级 | 任务数 | 占比 |
|--------|--------|------|
| P0（紧急） | 35 | 53.0% |
| P1（重要） | 19 | 28.8% |
| P2（一般） | 12 | 18.2% |

### 按复杂度分布

| 复杂度 | 任务数 | 说明 |
|--------|--------|------|
| 简单（1-3） | 23 | 配置、UI、简单逻辑 |
| 中等（4-6） | 35 | 模块集成、API 开发 |
| 复杂（7-10） | 8 | 链上验证、推荐算法 |

### 按阶段分布

| 阶段 | 任务数 | 工作日 | 周数 |
|------|--------|--------|------|
| Phase 1 | 35 | 52.5 | 10.5 |
| Phase 2 | 19 | 38 | 7.6 |
| Phase 3 | 12 | 26.4 | 5.3 |
| **总计** | **66** | **116.9** | **23.4** |

---

## 🔗 依赖关系

### 关键路径

1. **后端部署路径**: Task 1 → 2,3 → 4 → 5 → 7
2. **钱包迁移路径**: Task 12 → 13 → 14 → 15 → 16
3. **用户中心路径**: Task 27 → 28,29,30,31

### 并行开发机会

✅ **Phase 1 并行机会**:
- 后端基础架构（Task 1-7）**可与**钱包迁移（Task 12-16）并行
- KYC 模块（Task 17-21）**可与**任务中心（Task 22-26）并行

✅ **Phase 2 并行机会**:
- Stage 2.1（Task 36-41）、Stage 2.2（Task 42-46）、Stage 2.3（Task 47-50）三个 Stage **可并行开发**

✅ **Phase 3 并行机会**:
- Stage 3.1（Task 55-58）、Stage 3.2（Task 59-60）**可并行开发**

---

## ⚠️ 风险评估

### 高风险项

| 风险 | 概率 | 影响 | 缓解策略 |
|------|------|------|---------|
| 后端开发延期 | 高（40%） | 高 | 分阶段交付，MVP 先行，设置 20% 缓冲时间 |
| 钱包迁移 Bug | 中（25%） | 高 | 充分测试，灰度发布，保留 RainbowKit 回滚预案 |
| Blockpass API 限制 | 中（20%） | 中 | 监控使用量，提前升级付费版（$299/月） |

### 中风险项

- 数据库设计缺陷（概率 30%）- 使用 Prisma 自动迁移，充分测试
- 性能瓶颈（概率 30%）- 性能测试，数据库索引优化
- 成本超支（概率 25%）- 实时监控成本，提前预警

---

## 💰 成本估算

### 开发成本

- **Phase 1**: 52.5 天 × 2 人 = 105 人天（约 5 周 × 2 人）
- **Phase 2**: 38 天 × 2 人 = 76 人天（约 4 周 × 2 人）
- **Phase 3**: 26.4 天 × 2 人 = 52.8 人天（约 2.6 周 × 2 人）

**总计**: 233.8 人天（约 **6 个月 × 2 人**）

### 运维成本（月度）

| 服务 | 初期（< 1000 用户） | 增长期（1000-10000 用户） |
|------|---------------------|---------------------------|
| Vercel | $0-20 | $20-50 |
| Railway | $5-20 | $20-100 |
| Supabase | $0-25 | $25-50 |
| Upstash | $0-10 | $10-30 |
| Blockpass | $0 | $299 |
| **总计** | **$5-75/月** | **$374-529/月** |

---

## 🚀 快速开始

### 准备工作

1. **注册第三方服务**:
   ```bash
   # Supabase: https://supabase.com
   # Upstash: https://upstash.com
   # Railway: https://railway.app
   # Blockpass: https://blockpass.org
   ```

2. **查看第一个任务**:
   ```bash
   cat .ultra/tasks/tasks.json | jq '.tasks[0]'
   ```

3. **启动开发**:
   ```bash
   /ultra-dev 1  # 开始 Task 1: 初始化 NestJS 后端项目
   ```

### 开发流程

```
Phase 1 (Week 1-8) → Phase 2 (Week 9-16) → Phase 3 (Week 17-24)
   ↓                      ↓                      ↓
后端 MVP               数据层优化            智能化升级
钱包迁移               链上索引              积分系统
用户中心               历史数据              数据分析
KYC + 任务             实时通知              智能推荐
```

---

## ✅ 成功标准

### Phase 1 完成标准

- [ ] 后端服务部署成功（Railway/Render 可访问）
- [ ] 社交登录正常工作（至少 Email + Google）
- [ ] 用户中心 6 个 Tab 全部上线
- [ ] KYC 流程完整测试通过（Tier 0/1/2）
- [ ] 任务系统支持至少 3 个链上任务
- [ ] 推荐系统邀请码生成和统计正常

### Phase 2 完成标准

- [ ] 链上数据索引器稳定运行（>99% 可用性）
- [ ] Portfolio 查询响应时间 < 100ms
- [ ] 历史数据 API 正常工作
- [ ] 实时通知推送延迟 < 5 秒
- [ ] 性能测试通过（1000 并发用户）

### Phase 3 完成标准

- [ ] 用户积分系统正常运行
- [ ] 积分排行榜实时更新
- [ ] 数据分析看板上线
- [ ] 智能推荐准确率 >70%
- [ ] API 文档完整（Swagger）

---

## 📚 相关文档

- **完整任务清单**: `.ultra/tasks/tasks.json`
- **深度分析报告**: 本次对话记录
- **技术选型说明**: 见 tasks.json 的 metadata.technicalStack
- **风险管理**: 见 tasks.json 的 risks 数组

---

**最后更新**: 2025-11-14
**文档版本**: v4.0
**生成工具**: Ultra Builder Pro 4.0 - `/ultra-plan`
